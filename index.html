<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Tierfakten Scraper Demo</title>
<style>
body { font-family: sans-serif; padding: 20px; }
button { font-size: 16px; padding: 10px; }
pre { background: #111; color: #0f0; padding: 15px; max-height: 400px; overflow:auto; }
</style>
</head>
<body>
<h1>üêæ Tierfakten Scraper Demo</h1>
<button id="load">Facts Laden</button>
<pre id="output">Noch nichts geladen.</pre>

<script>
// IndexedDB Setup
const dbName = "AnimalFactsDB";
const storeName = "facts";
let db;

const request = indexedDB.open(dbName,1);
request.onupgradeneeded = e => {
    db = e.target.result;
    db.createObjectStore(storeName, { autoIncrement:true });
};
request.onsuccess = e => db = e.target.result;
request.onerror = e => console.error(e);

// Helper: speichern
function saveFact(fact){
    const tx = db.transaction(storeName,"readwrite");
    tx.objectStore(storeName).add(fact);
}

// --- Fetch HTML via Proxy ---
async function fetchHTML(url){
    const proxy = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    const res = await fetch(proxy);
    const data = await res.json();
    return data.contents;
}

// --- Fakten extrahieren ---
function extractFacts(html, source){
    const parser = new DOMParser();
    const doc = parser.parseFromString(html,"text/html");
    let facts = [];

    // 1Ô∏è‚É£ Facts aus <ul>
    const lists = doc.querySelectorAll("ul li");
    lists.forEach(li => {
        let text = li.textContent.trim();
        if(text.length < 20) return; // zu kurz
        if(/¬©|Subscribe|Welcome|All Rights Reserved/i.test(text)) return;
        facts.push({
            animal: text.split(" ")[0],
            icon: "üêæ",
            text: text,
            tags: ["FunFact","Wildlife"],
            source: source
        });
    });

    // 2Ô∏è‚É£ Facts aus <p> (optional)
    const paragraphs = doc.querySelectorAll("p");
    paragraphs.forEach(p => {
        let text = p.textContent.trim();
        if(text.length < 20) return;
        if(/¬©|Subscribe|Welcome|All Rights Reserved/i.test(text)) return;
        facts.push({
            animal: text.split(" ")[0],
            icon: "üêæ",
            text: text,
            tags: ["FunFact","Wildlife"],
            source: source
        });
    });

    return facts;
}

// --- Button ---
document.getElementById("load").onclick = async () => {
    const urls = [
        {url:"https://a-z-animals.com/animals/lion/", source:"A-Z Animals"},
        {url:"https://a-z-animals.com/animals/tiger/", source:"A-Z Animals"},
        {url:"https://a-z-animals.com/animals/elephant/", source:"A-Z Animals"}
    ];

    let allFacts = [];

    for(let u of urls){
        try{
            const html = await fetchHTML(u.url);
            const facts = extractFacts(html, u.source);
            facts.forEach(saveFact);
            allFacts = allFacts.concat(facts);
        }catch(e){
            console.error("Fehler bei URL", u.url, e);
        }
    }

    document.getElementById("output").textContent = JSON.stringify(allFacts, null, 2);
};
</script>
</body>
</html>
