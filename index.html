<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Random Tierfakten â€“ Live Demo</title>
<style>
body { font-family: sans-serif; padding: 20px; }
button { font-size: 16px; padding: 10px; }
pre { background: #111; color: #0f0; padding: 15px; max-height: 400px; overflow:auto; }
</style>
</head>

<body>
<h1>ğŸ¾ Random Tierfakten (ohne APIâ€‘Key)</h1>
<button id="load">Random Facts laden</button>
<pre id="out">Noch nichts geladen.</pre>

<script>
// --- ZufÃ¤llige Tiere ---
const animals = [
  "Lion","Octopus","Axolotl","Platypus","Narwhal",
  "Elephant","Raccoon","Hummingbird","Fennec fox","Cuttlefish"
];

// --- IndexedDB ---
const dbReq = indexedDB.open("AnimalFactsDB", 1);
let db;

dbReq.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore("facts", { autoIncrement: true });
};
dbReq.onsuccess = e => db = e.target.result;

// --- Wikipedia Fetch ---
async function getWikiSummary(title){
  const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error("Wiki Fehler");
  return res.json();
}

// --- Fact erzeugen ---
function makeFact(data){
  return {
    animal: data.title,
    icon: "ğŸ¾",
    text: data.extract,
    tags: ["wiki","random","animal"],
    source: "Wikipedia"
  };
}

// --- Save ---
function saveFact(fact){
  const tx = db.transaction("facts","readwrite");
  tx.objectStore("facts").add(fact);
}

// --- Button ---
document.getElementById("load").onclick = async () => {
  const out = document.getElementById("out");
  out.textContent = "Lade Fakten...\n";

  let results = [];

  for(let i=0;i<5;i++){
    const animal = animals[Math.floor(Math.random()*animals.length)];
    try{
      const data = await getWikiSummary(animal);
      const fact = makeFact(data);
      saveFact(fact);
      results.push(fact);
    }catch(e){
      console.error(e);
    }
  }

  out.textContent = JSON.stringify(results, null, 2);
};
</script>
</body>
</html>
